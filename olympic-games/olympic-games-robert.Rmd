---
title: "Olympic Games Analysis"
output: 
  html_document:
    toc: true
    toc_float: true
    df_print: paged
    code_folding: show  
    theme: united
    highlight: tango
    number_sections: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Read in the Participants Data.txt

```{r}
library(tidyverse)
library(readr)
df <- read_csv("participants.csv", 
    col_types = cols(age = col_integer(), 
        athlete = col_character(), city = col_character(), 
        discipline = col_character(), game = col_character(), 
        height = col_integer(), sport = col_character(), 
        weight = col_number()))
```
# Understand the data
-	Print the first 5 observations
```{r}
head(df,5)
```
-	How many rows and columns does the data set have?
```{r}
df%>% 
  nrow()
```

```{r}
df%>% 
  ncol()
```

-	Display the variable types
```{r}
summary(df)
```
# Counting participants
-	Display the 10 countries with the highest number of participants.

```{r}
df%>%
  arrange(athlete)%>%                 # Creates a list of all distinct athlete's names which is ordered alphabetically
  count(country, sort = TRUE)%>%      # Counts the number of times, each country is present in this list of distinct athletes and sorts the outcome in descending order
  head(10)                            # Displays the top 10 Values of this list
```
-	Calculate the number of participants from Germany, including West Germany and East Germany. 
```{r}
df%>%
  filter(country %in% c("Germany","West Germany", "East Germany"))%>%
  count()%>%
  head()
```
# Body mass index
-	Add a column bmi that contains the athlete's body mass index. The body mass index is defined as weight / height^2 measured in kilogram / meter^2
```{r}
df%>%
  mutate(bmi = weight/((height/100)^2))%>%    # create a new column whereby changing the height variable from centimeters to meters.
  filter(!is.na(bmi))%>%                      # filter the obvservations where we do not get calculated values due to missing weight and/or height data.
  head()
```
-	Calculate the minimum, average, and maximum BMI
```{r}
dfb <- df%>%                                  # creates a new data frame with bmi as a permanent column
  mutate(bmi = weight/((height/100)^2))%>%    # create a new column whereby changing the height variable from centimeters to meters.
  filter(!is.na(bmi))                         # filter the obvservations where we do not get calculated values due to missing weight and/or height data.
```

```{r}
  dfb%>%
  summarise(mean = mean(bmi))                 # zeigt das arithmetische Mittel der Body Mass Indizes an. Es liegt im Bereich der "Normalgewichtigen"
```
```{r}
  dfb%>%
  summarise(median = median(bmi))%>%          # zeigt den Median der Body Mass Indizes an, auch dieser liegt im normalen Bereich
  head()
```

```{r}
  dfb%>%
  summarise(max = max(bmi))%>%                    # zeigt den maximalen Body Mass Index an. Dieser liegt im Bereich der Hyper Obese (Class VI)
  head()
```
```{r}
  dfb%>%
  summarise(min = min(bmi))%>%                    # Das Minimum der BMI der Athleten zeigt, dass hier auch "very severly underweight" Sportler aktiv waren.
  head()
```
-	How many participants of the sport Rhythmic Gymnastics are at least severely underweight? Use the BMI table below to answer this question.
```{r}
  dfb%>%
  filter(sport=="Rhythmic Gymnastics")%>%         # filter "Rhythmic Gymnastics" from variable sport
  filter(bmi <=16)%>%                             # filter those wiht a bmi, smaller or equal to 16
  count()%>%                                      # count them
  head()
```
-	What percentage of the participants of the sport Weightlifting are at least severely obese? Use the BMI table below to answer this question.

|                                         | From (incl.) | To (excl.) |
|-----------------------------------------|--------------|------------|
| Very severely underweight               |              | 15         |
| Severely underweight                    | 15           | 16         |
| Underweight                             | 16           | 18.5       |
| Normal (healthy weight)                 | 18.5         | 25         |
| Overweight                              | 25           | 30         |
| Obese Class I   (Moderately obese)      | 30           | 35         |
| Obese Class   II (Severely obese)       | 35           | 40         |
| Obese Class   III (Very severely obese) | 40           | 45         |
| Obese Class   IV (Morbidly obese)       | 45           | 50         |
| Obese Class V   (Super obese)           | 50           | 60         |
| Obese   Class VI (Hyper obese)          | 60           |            |

```{r}
nwlp <- dfb%>%                                    # nwlp is the number of weightlifting participants
  filter(sport=="Weightlifting")%>%               # filter "Weightlifting" from variable sport
  count()%>%
  head()
```

```{r}
nobwlp <- dfb%>%                                  # nwlp is the number of at least severely obese weightlifting participants
  filter(sport=="Weightlifting")%>%               # filter "Weightlifting" from variable sport
  filter(bmi >=35)%>%                             # filter those with a bmi, equal or larger than 35
  count()%>%                                      # count them
  head()
```

```{r}
((nobwlp / nwlp)*100)%>%                          # divide the number of severely obese weightlifters by total number of weightlifters and mulitply by 100 to get a percentage value
print()
```
# Joining data
-	Read in athletes.xlsx and medallists.txt
```{r}
# During later steps, it became obvious, that the names in the variable "athlete" have been spelled or rather syntaxed differently in the different data frames that are to be joined. Some of the names (i.e. around 6 thousand of the athletes) have names syntaxed like this:
# A. Joshua "Josh" West           in athletes and participants files and
# "A. Joshua ""Josh"" West"       in medallists file

# In order to avoid distorted figures later, I tried to eliminate the quotation marks in all three files in order to get three tidy data frames. I tried this (among others) with the stringr command str_replace_all in order to exchange all quotation marks (matched patterns) in the string with Null values. Extra problems arose due to the fact that quotation marks are a special character in R that is used to surround string values...

# df%>%str_replace_all("[\"]", "") this was my last try after many of other approaches... it did not deliver the desired result. Hoping for a hint how to do this in R... for now I have replaced the "" with " in the medallist file with the help of a text editor and will continue with this cleaned file.
```

```{r}
library(readr)
medallists <- read_delim("cleanmedallists.txt", 
    ";", escape_double = FALSE, trim_ws = TRUE,
    col_types = cols(game = col_character(),
  discipline = col_character(),
  medal = col_character(),
  athlete = col_character()))
View(medallists)

library(readxl)
athletes <- read_excel("athletes.xlsx")
View(athletes)
```
-	Join participants, athletes, and medalists into one large data frame. Make the join in such a way that we do not lose information contained in the participants data.
```{r}
dff <- df%>%
  full_join(athletes, by=c("athlete"))%>%                         # joining the participants with the gender information of the athletes by their name
  full_join(medallists, by=c("game", "discipline", "athlete"))    # joining the resulting table with the medallists information by game, discipline and athlete, i.e. their names
```
# Medal table	
-	Create the all-time Olympic Games medal table and display the first 10 entries. Medal tables are sorted from best to worst (sort first the number of golds, then silver, then bronze). The table should have the following columns. 

| country | Gold | Silver | Bronze |
|---------|------|--------|--------|

```{r}
gold <- dff%>%                                                          # Creating a tibble that stores the data for Gold medals by country
  filter(medal == "Gold")%>%                                            # Filtering every oberservation (case) where there is "Gold" mentioned
  count(country, medal = "Gold", wt = NULL, sort = TRUE, name ="Gold")  # Counting and sorting the result (which includes a grouping by "country")
select(gold, -medal)                                                    # Dropping the redundant column "medal"
```

```{r}
silver <- dff%>%                                                        # Creating a tibble for silver medals just like the one for gold
  filter(medal == "Silver")%>%
  count(country, medal = "Silver", wt = NULL, sort = TRUE, name ="Silver")
select(silver, -medal)
```

```{r}
bronze <- dff%>%                                                        # Creating a tibble for the bronze medals as well
  filter(medal == "Bronze")%>%
  count(country, medal = "Bronze", wt = NULL, sort = TRUE, name ="Bronze")
select(bronze, -medal)
```

```{r}
atomt <- gold%>%                                                        # Joining the three medal tables into atomt (i.e. all time olympic medal table)
  full_join(silver, by=c("country"))%>%
  full_join(bronze, by=c("country"))
select(atomt, -medal, -medal.y, -medal.x)%>%                            # Removing three columns that have no reason to remain there
  arrange(desc(Gold))%>%                                                # Arranging the data by the "Gold-Standard"
  head(10)                                                              # Voilá (these ca. 5 lines of distinct code taken me about half an hour each)
```
-	Create a similar medal table for athletes. Display the 10 most successful athletes in the Olympics history, and also display the athlete’s country. The table should have the following columns.

|athlete | country | Gold | Silver | Bronze |
|--------|---------|------|--------|--------|

```{r}
gm <- dff%>%                                                          # Creating a tibble that stores the data for Gold medals by athlete
  filter(medal == "Gold")%>%                                            # Filtering every oberservation (case) where there is "Gold" mentioned
  count(athlete, medal = "Gold", wt = NULL, sort = TRUE, name ="Gold")  # Counting and sorting the result (which includes a grouping by "athlete")
select(gm, -medal)                                                    # Dropping the redundant column "medal"
```
```{r}
sm <- dff%>%                                                          # Creating a tibble that stores the data for Silver medals by athlete
  filter(medal == "Silver")%>%                                            # Filtering every oberservation (case) where there is "Silver" mentioned
  count(athlete, medal = "Silver", wt = NULL, sort = TRUE, name ="Silver")  # Counting and sorting the result (which includes a grouping by "athlete")
select(sm, -medal)                                                    # Dropping the redundant column "medal"
```
```{r}
bm <- dff%>%                                                          # Creating a tibble that stores the data for Bronze medals by athlete
  filter(medal == "Bronze")%>%                                            # Filtering every oberservation (case) where there is "Bronze" mentioned
  count(athlete, medal = "Bronze", wt = NULL, sort = TRUE, name ="Bronze")  # Counting and sorting the result (which includes a grouping by "athlete")
select(bm, -medal)                                                    # Dropping the redundant column "medal"
```
```{r}
ath_co <- dff%>%                      # Creating a tibble that stores country by athlete
  filter(!is.na(medal))%>%            # filter only those obersvations, where there are inputs for medals     
  select(country, athlete)%>%         # select only the columns country and athlete for the next operation
  distinct(country, athlete)          # create a table that has the information of country and athlete's name for the medallists
ath_co <- ath_co [ ,c(2,1)]           # reordering colums
```


```{r}
aatomt <- ath_co%>%                         # creating a new table by fusing athletes' country
  full_join(gm, by=c("athlete"))%>%         # with gold medals count
  full_join(sm, by=c("athlete"))%>%         # with silver medals count
  full_join(bm, by=c("athlete"))            # with bronze medals count
select(aatomt, -medal, -medal.x, -medal.y)%>% # dropping three columns that have no further use
  arrange(desc(Gold))%>%                    # sort by the gold medal as standard
  head(10)                                  # Done
```
# Athlete’s age
-	Display the youngest and the oldest participant together with information on the Olympic games and the sports and disciplines at which they participated.

```{r}
oldst <- dff%>%
  select(game, sport, discipline, athlete, age)%>%    # selecting only those columns from the base frame that are needed
  filter(!is.na(age))%>%                              # filter out any NAs in the age column
  filter(age == max(age))%>%                          # identify the oldest athlete
```

```{r}
yngst <- dff%>%                                       # same procedure for the youngest athlete
  select(game, sport, discipline, athlete, age)%>%
  filter(!is.na(age))%>%  
  filter(age == min(age))%>%
```

```{r}
xtrage <- bind_rows(oldst, yngst)%>%                  # combine the two rows into one "target" view
  view()
```
-	Calculate the minimum, average, and maximum age of medal winners per sport. Display the 5 sports with the highest and lowest average ages, respectively.
```{r}
t5sports <- dff%>%
  select(game, sport, discipline, athlete, age, medal)%>%
  filter(!is.na(age))%>%
  filter(!is.na(medal))%>%
  count(sport)%>%
  view()

```

  
# Athlete’s sex
-	Create a table that shows for each sport the proportions of men and women among the gold medal winners
-	In the history of Olympic games, which sports have been exclusively reserved for men and women, respectively.

# Special athletes
-	Display all athletes that have won a gold medal both at summer and winter Olympic games.

